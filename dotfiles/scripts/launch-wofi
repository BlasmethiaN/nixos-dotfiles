#!/usr/bin/env bash

THEME_DIR="$HOME/nixos-dotfiles/dotfiles/wofi"
FLAVOUR="${2:-macchiato}"
STYLE_PATH="$THEME_DIR/src/$FLAVOUR/style.css"
CONFIG_PATH="$THEME_DIR/config"

if [[ ! -f "$STYLE_PATH" ]]; then
    echo "❌ Flavour '$FLAVOUR' not found in $STYLE_PATH"
    exit 1
fi

MODE="${1:-app}"

case "$MODE" in
  app)
    wofi \
      --conf "$CONFIG_PATH" \
      --style "$STYLE_PATH" \
      --show drun
    ;;
  
  win|window)
    hyprctl clients -j \
      | jq -r '.[] | select(.class != null) | "\(.class) - \(.title // .initialTitle // "unknown")\t\(.address)"' \
      | wofi \
          --conf "$CONFIG_PATH" \
          --style "$STYLE_PATH" \
          --show dmenu \
          --prompt "Switch to window:" \
      | awk -F'\t' '{print $2}' \
      | xargs -r hyprctl dispatch focuswindow address:
    ;;
  
  *)
    echo "❌ Unknown mode '$MODE'. Use: app | win"
    exit 1
    ;;
esac

